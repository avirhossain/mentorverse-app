
{
  "entities": {
    "Mentor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Mentor",
      "type": "object",
      "description": "Represents a mentor in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the mentor."
        },
        "name": {
          "type": "string",
          "description": "The mentor's full name."
        },
        "email": {
          "type": "string",
          "description": "The mentor's email address.",
          "format": "email"
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the mentor."
        },
        "expertise": {
          "type": "array",
          "description": "Areas of expertise of the mentor.",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "enum": ["active", "suspended"],
          "description": "The current status of the mentor's account."
        },
        "reviews": {
          "type": "array",
          "description": "A list of reviews submitted by mentees.",
          "items": {
            "type": "object",
            "properties": {
              "mentee": {
                "type": "string",
                "description": "Name of the mentee who wrote the review."
              },
              "date": {
                "type": "string",
                "format": "date",
                "description": "Date the review was submitted."
              },
              "rating": {
                "type": "number",
                "description": "Star rating from 1 to 5."
              },
              "text": {
                "type": "string",
                "description": "The text content of the review."
              }
            },
            "required": ["mentee", "date", "rating", "text"]
          }
        },
        "availableTimeslots": {
          "type": "array",
          "description": "Available time slots for the mentor.",
          "items": {
            "type": "string"
          }
        },
        "sessionCost": {
          "type": "number",
          "description": "The cost of a session with the mentor."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "bio",
        "expertise",
        "status",
        "availableTimeslots",
        "sessionCost"
      ]
    },
    "Mentee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Mentee",
      "type": "object",
      "description": "Represents a mentee in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the mentee."
        },
        "name": {
          "type": "string",
          "description": "The mentee's full name."
        },
        "email": {
          "type": "string",
          "description": "The mentee's email address.",
          "format": "email"
        },
        "interests": {
          "type": "array",
          "description": "The mentee's areas of interest.",
          "items": {
            "type": "string"
          }
        },
        "mentorshipGoal": {
          "type": "string",
          "description": "The mentorship goal of the mentee."
        },
        "balance": {
          "type": "number",
          "description": "The user's account balance."
        },
        "status": {
            "type": "string",
            "enum": ["active", "suspended"],
            "description": "The current status of the mentee's account."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "interests",
        "mentorshipGoal",
        "status"
      ]
    },
    "Session": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Session",
      "type": "object",
      "description": "Represents a session between a mentor and a mentee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the session."
        },
        "mentorId": {
          "type": "string",
          "description": "Reference to Mentor. (Relationship: Mentor 1:N Session)"
        },
        "menteeId": {
          "type": "string",
          "description": "Reference to Mentee. (Relationship: Mentee 1:N Session)"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the session.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the session.",
          "format": "date-time"
        },
        "cost": {
          "type": "number",
          "description": "The cost of the session."
        },
        "notes": {
          "type": "string",
          "description": "Any notes related to the session."
        }
      },
      "required": [
        "id",
        "mentorId",
        "menteeId",
        "startTime",
        "endTime",
        "cost"
      ]
    },
    "UniqueSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UniqueSession",
      "type": "object",
      "description": "Represents a unique session offering created by the admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the unique session."
        },
        "title": {
          "type": "string",
          "description": "The title of the unique session."
        },
        "description": {
          "type": "string",
          "description": "A description of the unique session."
        },
        "mentorId": {
          "type": "string",
          "description": "Reference to Mentor. (Relationship: Mentor 1:N UniqueSession)"
        },
        "cost": {
          "type": "number",
          "description": "The cost of the unique session."
        },
        "availableSlots": {
          "type": "number",
          "description": "The number of available slots for the unique session."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "mentorId",
        "cost",
        "availableSlots"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a recommendation for a mentee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "menteeId": {
          "type": "string",
          "description": "Reference to Mentee. (Relationship: Mentee 1:N Recommendation)"
        },
        "mentorId": {
          "type": "string",
          "description": "Reference to Mentor. (Relationship: Mentor 1:N Recommendation)"
        },
        "uniqueSessionId": {
          "type": "string",
          "description": "Reference to UniqueSession. (Relationship: UniqueSession 1:N Recommendation)"
        },
        "reason": {
          "type": "string",
          "description": "The reason for the recommendation."
        },
        "timestamp": {
          "type": "string",
          "description": "The time the recommendation was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "menteeId",
        "mentorId",
        "uniqueSessionId",
        "reason",
        "timestamp"
      ]
    },
    "Tip": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tip",
      "type": "object",
      "description": "Represents a tip or resource for mentees.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tip."
        },
        "type": {
          "type": "string",
          "description": "The type of the tip.",
          "enum": ["Article", "YouTube", "Website"]
        },
        "title": {
          "type": "string",
          "description": "The title of the tip."
        },
        "summary": {
          "type": "string",
          "description": "A brief summary of the tip."
        },
        "content": {
          "type": "string",
          "description": "The full content of the tip (for articles)."
        },
        "link": {
          "type": "string",
          "description": "The URL for the tip (for YouTube/Website)."
        }
      },
      "required": ["id", "type", "title", "summary"]
    },
    "Coupon": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Coupon",
      "type": "object",
      "description": "Represents a redeemable coupon for adding balance.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The coupon code itself, used as the document ID."
        },
        "amount": {
          "type": "number",
          "description": "The monetary value of the coupon."
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "The expiration date of the coupon."
        },
        "isUsed": {
          "type": "boolean",
          "description": "Whether the coupon has already been redeemed."
        }
      },
      "required": ["id", "amount", "isUsed"]
    },
    "PendingPayment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PendingPayment",
      "type": "object",
      "description": "Represents a payment submission awaiting manual verification.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment request."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who submitted the payment."
        },
        "transactionId": {
          "type": "string",
          "description": "The bKash transaction ID provided by the user."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the payment."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "approved", "rejected"],
          "description": "The verification status of the payment."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the payment request was created."
        }
      },
      "required": ["id", "userId", "transactionId", "amount", "status", "createdAt"]
    },
    "BalanceTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BalanceTransaction",
      "type": "object",
      "description": "Represents a transaction that affects a user's balance.",
      "properties": {
        "id": { "type": "string", "description": "Unique ID for the transaction." },
        "userId": { "type": "string", "description": "The ID of the user." },
        "amount": { "type": "number", "description": "The transaction amount (can be positive or negative)." },
        "source": { "type": "string", "enum": ["coupon", "bkash", "session_payment"], "description": "The source of the transaction." },
        "description": { "type": "string", "description": "A human-readable description of the transaction." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of the transaction." }
      },
      "required": ["id", "userId", "amount", "source", "description", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com",
      "facebook.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/mentors/{mentorId}",
        "definition": {
          "entityName": "Mentor",
          "schema": {
            "$ref": "#/backend/entities/Mentor"
          },
          "description": "Collection to store mentor profiles.",
          "params": [
            {
              "name": "mentorId",
              "description": "The unique identifier of the mentor."
            }
          ]
        }
      },
      {
        "path": "/users/{menteeId}",
        "definition": {
          "entityName": "Mentee",
          "schema": {
            "$ref": "#/backend/entities/Mentee"
          },
          "description": "Collection to store mentee profiles.",
          "params": [
            {
              "name": "menteeId",
              "description": "The unique identifier of the mentee."
            }
          ]
        }
      },
      {
        "path": "/users/{menteeId}/sessions/{sessionId}",
        "definition": {
          "entityName": "Session",
          "schema": {
            "$ref": "#/backend/entities/Session"
          },
          "description": "Subcollection to store sessions booked by a specific mentee. Includes denormalized 'menteeId' for authorization independence.",
          "params": [
            {
              "name": "menteeId",
              "description": "The unique identifier of the mentee."
            },
            {
              "name": "sessionId",
              "description": "The unique identifier of the session."
            }
          ]
        }
      },
      {
        "path": "/unique_sessions/{uniqueSessionId}",
        "definition": {
          "entityName": "UniqueSession",
          "schema": {
            "$ref": "#/backend/entities/UniqueSession"
          },
          "description": "Collection to store unique session offerings created by the admin.",
          "params": [
            {
              "name": "uniqueSessionId",
              "description": "The unique identifier of the unique session."
            }
          ]
        }
      },
      {
        "path": "/users/{menteeId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Subcollection to store personalized mentor recommendations for a mentee. Includes denormalized 'menteeId' for authorization independence.",
          "params": [
            {
              "name": "menteeId",
              "description": "The unique identifier of the mentee."
            },
            {
              "name": "recommendationId",
              "description": "The unique identifier of the recommendation."
            }
          ]
        }
      },
      {
        "path": "/tips/{tipId}",
        "definition": {
          "entityName": "Tip",
          "schema": {
            "$ref": "#/backend/entities/Tip"
          },
          "description": "Collection to store tips and resources for mentees.",
          "params": [
            {
              "name": "tipId",
              "description": "The unique identifier of the tip."
            }
          ]
        }
      },
      {
        "path": "/coupons/{couponId}",
        "definition": {
          "entityName": "Coupon",
          "schema": {
            "$ref": "#/backend/entities/Coupon"
          },
          "description": "Collection of redeemable coupons.",
          "params": [
            {
              "name": "couponId",
              "description": "The unique coupon code."
            }
          ]
        }
      },
      {
        "path": "/pending_payments/{paymentId}",
        "definition": {
          "entityName": "PendingPayment",
          "schema": {
            "$ref": "#/backend/entities/PendingPayment"
          },
          "description": "Collection for payment submissions awaiting manual verification.",
          "params": [
            {
              "name": "paymentId",
              "description": "The unique ID for the payment submission."
            }
          ]
        }
      },
      {
        "path": "/balance_transactions/{transactionId}",
        "definition": {
          "entityName": "BalanceTransaction",
          "schema": { "$ref": "#/backend/entities/BalanceTransaction" },
          "description": "Logs all changes to a user's balance for auditing purposes.",
          "params": [{ "name": "transactionId", "description": "The unique ID for the balance transaction." }]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely manage mentors, mentees, sessions, unique session offerings, and personalized recommendations within the MentorVerse application. The structure emphasizes authorization independence, clarity, and scalability.\n\nAuthorization Independence (CRITICAL): To avoid hierarchical authorization dependencies (`get()`), the design denormalizes authorization context where necessary. For example, access to sessions within a mentee's profile does not require fetching the mentee's profile to verify ownership. Instead, the session document itself contains the `menteeId`. Similarly, global roles (admin) are managed via the existence of a document in dedicated collections, rather than relying on custom claims.\n\nStructural Segregation (Homogeneous Security Posture): The structure segregates data based on access needs.  User-owned data is stored under the `/users/{userId}` path, allowing for simple path-based ownership rules.  Admin-created unique sessions are stored in a separate collection, `/unique_sessions`, to distinguish them from user-created sessions.\n\nAccess Modeling (Standardization and Consistency): The structure uses consistent patterns for authorization:\n*   Private Data: Path-Based ownership is enforced for mentee-specific data (e.g., recommendations under `/users/{menteeId}/recommendations/{recommendationId}`).\n*   Collaborative Data:  Not explicitly needed in this design, as no entities require collaborative access.\n*   Global Roles (DBAC): Admin privileges are checked by existence in `/roles_admin/{uid}`.\n\nQAPs (Rules are not Filters): The structure supports secure `list` operations by ensuring that collections contain documents with homogeneous security requirements. For example, listing sessions is secure because access to each session is determined by the path (user-owned) and/or role, not by filtering based on document content.\n\nInvariants: The structure enforces data integrity by leveraging path-based ownership to ensure that mentees can only access their own sessions and recommendations. Timestamps are used to maintain the order and history of recommendations."
  }
}
